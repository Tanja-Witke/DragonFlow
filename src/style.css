@import "tailwindcss";

/* Design tokens: ToDojo v2 palette */
:root {
  /* core */
  --clr-bg: #12161B;          /* Background */
  --clr-surface: #161B22;     /* Surface */
  --clr-card: #1B2128;        /* Card */
  --clr-elev: #222A33;        /* Elevated */
  --clr-border: #2C3540;      /* Border/Divider */
  --clr-text: #E9EEF2;        /* Text Primary */
  --clr-text-2: #C6D0DA;      /* Text Secondary (brighter) */
  --clr-muted: #86939F;       /* Muted */

  /* brand & accents */
  --clr-primary: #8AD5C7;     /* Glassy Teal */
  --clr-accent: #9CC8FF;      /* Ice Blue */
  --clr-accent-2: #D48C7E;    /* Soft Coral */

  /* semantic */
  --clr-success: #58B487;
  --clr-warning: #D7B164;
  --clr-danger:  #C75C5C;

  /* utilities */
  --clr-focus: #8AD5C7;
  --shadow: 0 6px 24px rgba(0,0,0,.6);
  --shadow-modal: 0 16px 40px rgba(0,0,0,.75);
  /* responsive sizing */
  --row-nominal: clamp(36px, 5vh, 64px);
  --list-header-h: clamp(36px, 4.5vh, 64px);
  --list-footer-h: clamp(54px, 6vh, 84px);

  /* frosted glass settings */
  --frost-blur: 14px;
  --frost-sat: 1.15;
  --alpha-bar: 18%;   /* header/footer transparency */
  --alpha-rail: 58%;  /* side rail opacity (darker than cards) */
  --alpha-card: 42%;  /* main cards opacity (higher = more opaque) */
  --alpha-elev: 62%;  /* elevated tiles opacity */
  --tone-medium: #2A2F37; /* medium tone, updated from image */
  --frost-border: color-mix(in oklab, white 10%, transparent);
  --app-bg-image: url('../images/image-background.jpg');
  /* derived dynamic accent (set at runtime), with a safe default */
  --accent-bright: #9EE7DB;
}

/* Helper palette classes */
@layer components {
  .app-bg      { background-color: var(--clr-bg); background-image: var(--app-bg-image); background-size: cover; background-position: center; background-attachment: fixed; color: var(--clr-text); }
  /* Side rail: darker than cards, frosted and slightly transparent */
  .side-rail   { background: color-mix(in oklab, var(--clr-card) 78%, black 6%); backdrop-filter: saturate(var(--frost-sat)) blur(var(--frost-blur)); border-color: var(--frost-border); }
  .surface     { background: color-mix(in oklab, var(--clr-card) var(--alpha-card), transparent); backdrop-filter: saturate(var(--frost-sat)) blur(var(--frost-blur)); border: 1px solid var(--frost-border); color: var(--clr-text); }
  .elev        { background: color-mix(in oklab, var(--clr-elev) var(--alpha-elev), transparent); backdrop-filter: saturate(var(--frost-sat)) blur(var(--frost-blur)); border: 1px solid var(--frost-border); color: var(--clr-text); }
  .border-div  { border-color: var(--clr-border); }
  .text-main   { color: var(--clr-text); }
  .text-sec    { color: var(--clr-text-2); }
  .text-muted  { color: var(--clr-muted); }
  .text-primary{ color: var(--clr-primary); }
  .text-danger { color: var(--clr-danger); }
  .bg-surface  { background: color-mix(in oklab, var(--clr-surface) var(--alpha-bar), transparent); backdrop-filter: saturate(var(--frost-sat)) blur(var(--frost-blur)); }
  .bg-elev     { background: color-mix(in oklab, var(--clr-elev) var(--alpha-bar), transparent); backdrop-filter: saturate(var(--frost-sat)) blur(var(--frost-blur)); }
  .is-active   { background: color-mix(in oklab, var(--clr-elev) 85%, black 0%); color: var(--clr-text); }

  .btn-primary { @apply px-3 py-1.5 rounded-lg text-white shadow transition; background: var(--clr-primary); }
  .btn-primary { cursor: pointer; }
  .btn-primary:hover { filter: brightness(1.05); }
  .btn-primary:active { filter: brightness(0.95); }
  .btn-primary:focus-visible { box-shadow: 0 0 0 2px var(--clr-focus); }

  .btn-outline { @apply px-3 py-1.5 rounded-lg transition; color: var(--clr-text-2); background: var(--clr-surface); cursor: pointer; }
  .btn-outline:hover { filter: brightness(1.05); color: var(--clr-text); }
  .btn-outline:focus-visible { box-shadow: 0 0 0 2px var(--clr-focus); }
  /* selected toggle state (e.g., Task/Note in add menu) */
  .btn-outline.is-active {
    background: var(--interactive-hover);
    color: var(--clr-text);
  }

  .btn-ghost   { @apply px-2 py-1 rounded transition; color: var(--clr-text-2); cursor: pointer; }
  .btn-ghost:hover { background: color-mix(in oklab, var(--clr-elev) 92%, black 0%); }
  .btn-ghost:focus-visible { box-shadow: 0 0 0 2px var(--clr-focus); }
  /* Inline title edit (header) */
  .inline-edit { background: transparent; border: none; color: var(--clr-text); font: inherit; padding: 1px 4px; border-bottom: 1px dashed var(--clr-border); min-width: 3ch; }
  .inline-edit:focus { outline: none; border-bottom-color: var(--clr-focus); }

  .field       { @apply w-full rounded px-2 py-1 outline-none; background: var(--clr-surface); color: var(--clr-text); }

  .menu-pop    { @apply absolute z-10 w-44 rounded-xl shadow-xl p-1; right: 0; background: var(--tone-medium); color: var(--clr-text); border: none; overflow: hidden; position: absolute; }
  /* Make inner button hovers bleed to the rounded edges */
  .menu-pop { padding: 0; z-index: 200; }
  .menu-pop:focus { outline: none; }
  /* Header topbar elevated above content so menus overlay */
  .topbar { position: relative; z-index: 250; }
  .menu-pop .menu-item { width: 100%; display: block; }
  .menu-pop .menu-item:focus, .menu-pop .menu-item:focus-visible { outline: none; box-shadow: none; }
  .menu-pop.down { top: calc(100% + 6px); }
.menu-pop.up   { bottom: calc(100% + 6px); }
.menu-pop.right { right: 0; }
.menu-pop.left { left: 0; right: auto; }
.add-list-layer { position: fixed; inset: 0; z-index: 500; pointer-events: none; }
.add-list-floating { width: 260px; padding: 1rem; z-index: 510; pointer-events: auto; }
  .menu-item   { @apply w-full text-left px-3 py-2; display:block; border-radius: 0; color: var(--clr-text-2); }
  .menu-item { cursor: pointer; }
  .menu-item:hover { background: var(--interactive-hover); color: var(--clr-text); }
  .side-rail .menu-item:hover { background: color-mix(in oklab, var(--accent-bright) 60%, transparent); color: var(--clr-text); }
  .menu-item.danger { color: var(--clr-danger); }
  .menu-item.danger:hover {
    background: color-mix(in oklab, var(--clr-danger) 28%, var(--tone-medium) 72%);
    color: color-mix(in oklab, var(--clr-danger) 92%, white 8%);
  }

  .menu-fab    { @apply rounded-xl shadow-2xl p-2; background: var(--tone-medium); color: var(--clr-text); box-shadow: var(--shadow); width: auto; min-width: 12rem; max-width: min(90vw, 22rem); border: none; }
  /* Make full-width menus align with card inner gutters (~8px each side) */
  /* Align full-width menus with ticket (task) content, not card edge */
  .menu-fab.full { width: calc(100% - 22px); min-width: 0; max-width: none; border-top-left-radius: 12px; border-top-right-radius: 12px; margin: 0 11px; }
  .menu-up { position: absolute; left: 0; right: 0; bottom: 100%; z-index: 60; }
  .divider     { @apply my-1 border-t; border-color: var(--clr-border); }
  /* Subtle FAB to avoid drawing main attention */
  .fab         { @apply h-11 w-11 grid place-content-center shadow transition; background: color-mix(in oklab, var(--clr-elev) 94%, black 0%); color: var(--clr-text-2); box-shadow: var(--shadow); border-radius: 12px; cursor: pointer; }
  .fab:hover   { background: color-mix(in oklab, var(--clr-elev) 88%, black 0%); color: var(--clr-text); transform: translateY(-1px) scale(1.04); }
  .fab:active  { background: color-mix(in oklab, var(--clr-elev) 88%, black 0%); }

  .icon { width: 22px; height: 22px; display: inline-block; color: var(--clr-text); }
  .hover-elev:hover { background: color-mix(in oklab, var(--clr-elev) 90%, black 0%); }
  .icon-sm { width: 18px; height: 18px; }
  .no-scrollbar { scrollbar-width: none; }
  .no-scrollbar::-webkit-scrollbar { display: none; }
  .add-inline { display:inline-flex; align-items:center; gap:.4rem; color: var(--clr-text-2); padding:.25rem .5rem; border-radius:8px; }
  .add-inline { cursor: pointer; }
  .add-inline:hover { background: color-mix(in oklab, var(--clr-elev) 88%, black 0%); color: var(--clr-text); }

  /* Task variants */
.task-item { @apply rounded-lg transition; position: relative; padding-right: 4px; margin: 0 !important; box-sizing: border-box; }
  :root { --interactive-hover: color-mix(in oklab, var(--clr-primary) 40%, transparent); }
  .task-item:hover { background: var(--interactive-hover); }
  .task-item.milestone {
    border-left: 3px solid var(--interactive-hover);
    background: color-mix(in oklab, var(--interactive-hover) 72%, var(--clr-card) 28%);
  }
  /* Drag & drop indicators */
  .task-item.dragging { opacity: .55; }
  .task-item.drop-before::before,
  .task-item.drop-after::after {
    content: "";
    position: absolute;
    left: 8px; right: 8px; height: 2px;
    background: color-mix(in oklab, var(--accent-bright) 80%, white 20%);
    box-shadow: 0 0 6px color-mix(in oklab, var(--accent-bright) 40%, transparent);
  }
  .task-item.drop-before::before { top: -1px; }
  .task-item.drop-after::after { bottom: -1px; }
.note-entry { align-items: flex-start; padding-top: 0.75rem; padding-bottom: 0.75rem; min-height: auto; flex-direction: column; gap: .4rem; }
.note-body { color: var(--clr-text-2); line-height: 1.4; white-space: pre-line; font-size: .95rem; width: 100%; text-align: left; display: block; }
.note-child-indicator { display: inline-block; margin-top: .3rem; font-size: .7rem; text-transform: uppercase; letter-spacing: .08em; color: var(--clr-primary); }
.note-entry > .flex-1 { width: 100%; }
  .milestone-check .faux-checkbox {
    width: 20px;
    height: 20px;
    border-radius: 6px;
    border: 2px solid var(--interactive-hover);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: color-mix(in oklab, var(--interactive-hover) 80%, white 30%);
    opacity: .9;
  }
  .milestone-percent {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--clr-text);
  }
  .milestone-check .faux-checkbox svg { width: 14px; height: 14px; }
  .task-item.completing { animation: taskPop 180ms ease-out, taskFade 300ms ease-in 120ms forwards; }

  @keyframes taskPop {
    0% { transform: scale(1); }
    50% { transform: scale(1.03); background: color-mix(in oklab, var(--accent-bright) 22%, var(--clr-elev) 78%); }
    100% { transform: scale(1); }
  }
  @keyframes taskFade { to { opacity: 0; transform: translateX(12px); } }

  /* Celebration overlay (local, subtle — line rays, no circles) */
  .celebrate-overlay { position: absolute; inset: 0; pointer-events: none; }
  .ray { position:absolute; top:50%; left:50%; width:2px; height:10px; background: var(--accent-bright); border-radius:1px; transform-origin: center; transform: translate(-50%,-50%) rotate(var(--rot)); animation: rayFly 520ms ease-out forwards; }
  @keyframes rayFly {
    from { opacity:.9; transform: translate(-50%,-50%) rotate(var(--rot)) scaleY(1); }
    to   { opacity:0; transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) rotate(var(--rot)) scaleY(1.1); }
  }

  /* Add: full-line visual (kept for reference, currently not used) */
  .add-line { position: relative; display: grid; place-content: center; height: 56px; color: var(--clr-text-2); }
  .add-line::before { content: ""; position: absolute; left: 0; right: 0; top: 50%; height: 1px; background: var(--clr-border); }
  .add-line .label { position: relative; z-index: 1; display: inline-flex; align-items: center; gap: .5rem; padding: .25rem .6rem; border-radius: 9999px; background: var(--clr-card); }
  .add-line:hover { color: var(--clr-text); }

  /* Add tiles (muted full-card) */
  .muted-tile { background: color-mix(in oklab, var(--clr-surface) var(--alpha-bar), transparent); color: var(--clr-text); backdrop-filter: saturate(var(--frost-sat)) blur(var(--frost-blur)); border: none; cursor: pointer; }
  .muted-tile:hover { background: color-mix(in oklab, var(--clr-surface) calc(var(--alpha-bar) + 6%), transparent); color: var(--clr-text); }

  /* Add footer: pinned bottom region of list card */
  /* Footer covers entire bottom of card with same corners */
  /* List card as grid: tasks area + footer */
  .list-card { position: relative; overflow: hidden; }
  .list-element { position: relative; overflow: hidden; display: grid; grid-template-rows: var(--list-header-h) 1fr var(--list-footer-h); isolation: isolate; }
  .list-header { height: var(--list-header-h); }
  .task-area { min-height: 0; }
.add-footer { position: absolute; left: 50%; transform: translateX(-50%); width: calc(100% + 24px); bottom: 0; z-index: 5; background: color-mix(in oklab, var(--clr-card) var(--alpha-card), transparent); border-top: none; box-shadow: none; padding: 0; margin: 0; margin-top: 0; border-bottom-left-radius: inherit; border-bottom-right-radius: inherit; height: var(--list-footer-h); display:flex; align-items:center; justify-content:center; cursor: pointer; }
  .list-footer { position: absolute; left: 50%; transform: translateX(-50%); width: calc(100% + 24px); bottom: 0; z-index: 5; background: color-mix(in oklab, var(--clr-card) var(--alpha-card), transparent); border-top: none; box-shadow: none; padding: 0; margin: 0; margin-top: 0; border-bottom-left-radius: inherit; border-bottom-right-radius: inherit; height: var(--list-footer-h); color: var(--clr-text); display:flex; align-items:center; justify-content:center; cursor: pointer; }
  /* Kill any bottom gap by removing bottom border radius and overflow */
  .list-card { border-bottom-left-radius: 0; border-bottom-right-radius: 0; overflow: hidden; }
  .list-element .list-footer { border-bottom: 0; }
  /* Ensure no extra gap under the footer */
  .add-footer::after { content: ""; display: block; height: 0; }
  .list-card { margin-bottom: 0; }
  .list-element .list-scroll { margin-bottom: 0 !important; height: 100%; overflow-y: scroll; }
  .vlist > :last-child { margin-bottom: 0 !important; }
  /* Full-width hover highlight contained to footer */
  .add-footer .new-btn, .list-footer .new-btn {
    display:flex; align-items:center; justify-content:center; gap:.4rem;
    color: var(--clr-text); width: 100%; height: 100%; cursor: pointer; font-size: 0.95rem;
    background: transparent; border-radius: inherit; padding: 0;
  }
  .add-footer .new-btn:hover, .list-footer .new-btn:hover { background: var(--interactive-hover); }
  /* apply hover on the footer container to avoid flicker when moving over inner elements */
/* ensure footer remains positioned without hover overlays */
.add-footer, .list-footer { position: absolute; }
  /* Ensure inner button fills the footer height variable */
  .add-footer { height: var(--list-footer-h); }
  .add-footer .new-btn { min-height: 100%; height: 100%; width: 100%; }

  /* Bottom nav: icon with optional label (no hover jump) */
  .nav-btn { display: inline-flex; align-items: center; gap: .5rem; color: color-mix(in oklab, white 70%, var(--clr-text) 30%); }
  .nav-btn:not(.active) { cursor: pointer; }
  .nav-label { opacity: 0; width: 0; max-width: 0; overflow: hidden; white-space: nowrap; transition: all .15s ease; }
  .nav-btn.active { color: color-mix(in oklab, var(--accent-bright) 70%, white 50%); }
  .nav-btn.active .nav-label { opacity: 1; width: auto; max-width: 12rem; }

  /* Modern FAB hover */
  .fab:hover { transform: translateY(-1px) scale(1.04); }

  /* View tree menu */
  .view-menu { width: min(340px, 80vw); display: flex; flex-direction: column; gap: .4rem; overflow: visible; }
  .view-tree-wrapper { max-height: 240px; overflow: auto; border-radius: 12px; border: 1px solid var(--clr-border); padding: .25rem; }
  .view-tree-wrapper.compact { max-height: 200px; background: color-mix(in oklab, var(--clr-card) 85%, transparent); }
  .view-tree-list { list-style: none; margin: 0; padding: 0; min-width: 180px; }
  .view-node { position: relative; }
  .view-node + .view-node { margin-top: 2px; }
  .view-node-btn { width: 100%; display: flex; justify-content: space-between; align-items: center; gap: .5rem; }
  .view-node-btn.is-active { background: color-mix(in oklab, var(--clr-primary) 25%, transparent); color: var(--clr-text); }
  .view-node-btn.folder::after { content: '›'; font-size: .8rem; opacity: .6; }
  .view-node.folder > .view-submenu { display: none; position: absolute; top: -4px; left: calc(100% - 8px); z-index: 30; }
  .view-node.folder:hover > .view-submenu { display: block; }
  .view-submenu { padding-left: 8px; }
  .view-submenu .view-tree-list { background: color-mix(in oklab, var(--clr-card) 92%, transparent); border: 1px solid var(--clr-border); border-radius: 12px; padding: 4px; min-width: 180px; box-shadow: var(--shadow); }
  .view-mode-panel { border: 1px dashed var(--clr-border); border-radius: 12px; padding: .35rem; background: color-mix(in oklab, var(--clr-card) 70%, transparent); }
  .add-mode-tabs button { flex: 1; text-transform: uppercase; font-size: .7rem; }
  .add-mode-tabs { gap: .4rem; }

  .child-row { padding: .4rem .5rem; border-radius: 12px; background: color-mix(in oklab, var(--clr-card) 80%, transparent); }
  .chip { border-radius: 999px; border: 1px solid var(--clr-border); padding: .15rem .5rem; font-size: .75rem; background: transparent; cursor: pointer; }
  .chip:hover { background: color-mix(in oklab, var(--clr-primary) 25%, transparent); }
  .badge { font-size: .6rem; padding: .15rem .4rem; border-radius: 999px; background: color-mix(in oklab, var(--clr-primary) 40%, transparent); text-transform: uppercase; letter-spacing: .1em; }
  .view-path .path-seg { padding: 0 .25rem; border-radius: 999px; color: var(--clr-text); background: transparent; cursor: pointer; }
  .view-path .path-seg.is-current { font-weight: 600; cursor: pointer; }
  .view-path .path-seg:not(.is-current):hover { background: color-mix(in oklab, var(--clr-elev) 90%, transparent); }
}

/* Native controls */
input[type="checkbox"] {
  -webkit-appearance: none;
  appearance: none;
  width: 18px; height: 18px;
  border-radius: 6px;
  background: color-mix(in oklab, var(--clr-surface) 96%, white 4%);
  border: none;
  display: inline-grid; place-content: center;
  cursor: pointer;
}
input[type="checkbox"]:hover {
  background: color-mix(in oklab, var(--clr-surface) 92%, white 8%);
}
input[type="checkbox"]:checked {
  background: var(--clr-primary);
}
input[type="checkbox"]:checked::after {
  content: '';
  width: 8px; height: 12px;
  border-right: 2px solid #fff;
  border-bottom: 2px solid #fff;
  transform: translateY(-1px) rotate(45deg);
}
input[type="checkbox"]:focus-visible { outline: none; box-shadow: none; }
input[type="checkbox"]:disabled { opacity: .6; cursor: default; }

/* subdued, thinner scrollbars */
* { scrollbar-width: thin; scrollbar-color: color-mix(in oklab, var(--clr-text) 35%, transparent) transparent; }
::-webkit-scrollbar { height: 6px; width: 6px; }
::-webkit-scrollbar-thumb { background: color-mix(in oklab, var(--clr-text) 35%, transparent); border-radius: 9999px; }
::-webkit-scrollbar-track { background: transparent; }

/* place scrollbar on the left side for specific containers */
.scrollbar-left { direction: rtl; }
.scrollbar-left > * { direction: ltr; }
  /* vertical list snap to avoid half-visible last row */
  .vlist { scroll-snap-type: y mandatory; }
  /* legacy layout rules removed: list height and footer height now driven by grid + JS row-fit */
  .end-spacer { height: 8px; }
  .snap-start { scroll-snap-align: start; }
  /* Remove hover background where explicitly marked */
  .no-hover:hover { background: transparent !important; }
  /* Anchor add menu above footer within each card */
  .menu-up { position: absolute; left: 0; right: 0; bottom: calc(var(--list-footer-h)); z-index: 90; }
  /* Footer hover overlay to avoid flicker */
  .add-footer::after, .list-footer::after { content: ""; position: absolute; inset: 0; border-radius: inherit; background: var(--interactive-hover); opacity: 0; transition: opacity .12s ease; pointer-events: none; z-index: 0; }
  .add-footer:hover::after, .list-footer:hover::after { opacity: 1; }
  .add-footer .new-btn, .list-footer .new-btn { position: relative; z-index: 1; }
